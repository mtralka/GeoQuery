<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title> SEARCH PAGE </title>

        <meta name="author" content="Matthew Tralka">
        <meta name="description"
            content="">
        <meta name="keywords" content="">
        
        <!-- CSS -->
        <link rel="stylesheet" href="../static/css/normalize.css"/>
        
        <!--
            <link rel="stylesheet" href="{{ url_for ('static', filename= 'css/style.css') }}" />
        -->
        
        <link rel="stylesheet" href="../static/css/home.css"/>

  
        <!-- ADOBE FONTS -->
        <link rel="stylesheet" href="https://use.typekit.net/hwf2qbl.css">

        <!-- typed.js -->
        <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>

        <!--
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        -->

    </head>

    <body>

        <header class='nav'>
        
            <a class='nav-brand' href="/">

                <img src='../static/img/brand.png' alt='GeoQuery' width='70'>

            </a>

            <nav class='nav-sub'>

                <a href="/" class='nav-item'>

                    home

                </a>

                <a href="/search" class='nav-item'>

                    search

                </a>

                <a href="/about" class='nav-item'>

                    about

                </a>

            </nav>

        </header>

        <main>
            
            <div class="grid-container">

                <div class="left grid-minimum grid-card" >

                    <div id='search-info'>

                        <div class='info-heading'>

                            <h3>

                                Search: {{ task_id }}
        
                            </h3>
        
                            <h4>
        
                                Started: {{ started }}
        
                            </h4>

                            <p id='status'>

                                CODE

                            </p>

                        </div>

                            <div class="grid-container-results info-info">

                                <div class="t-left info-unit">

                                    <p>

                                        Latitude: {{ '%0.3f'| format(task.lat|float) }}

                                    </p>

                                </div>

                                <div class="t-mid info-unit">

                                    <p>
                                        
                                        Longitude: {{ '%0.3f'| format(task.lon|float) }}

                                    </p>

                                </div>

                                <div class="t-right info-unit">

                                    <p>

                                        {% if task.accuracy %}

                                            Accuracy: {{ task.accuracy }}
                                        
                                        {% else %}

                                            Accuracy: N/A

                                        {% endif %}
                                    </p>
                                    

                                </div>

                                <div class="b-left info-unit">

                                    <p>

                                        {% if task.min_taken %}

                                            From:  {{ task.min_taken }}
                                        
                                        {% else %}

                                            From:  N/A

                                        {% endif %}

                                        
                                    </p>

                                </div>

                                <div class="b-right info-unit">

                                    <p>

                                        
                                        {% if task.max_taken %}

                                            To:  {{ task.max_taken }}
                                        
                                        {% else %}

                                            To:  N/A

                                        {% endif %}

                                    </p>

                                </div>

                                <div class="m-left info-unit">

                                    <p>

                                        {% if task.radius %}

                                            Radius: {{ task.radius }} {{ task.radius_units }}
                                        
                                        {% else %}

                                            Radius: 5 {{ task.radius_units }}

                                        {% endif %}

                                    </p>

                                </div>

                                <div class="m-right info-unit">

                                    <p>

                                        {% if task.tags %}

                                            Tags: {{ task.tags }}
                                        
                                        {% else %}

                                            Tags: N/A

                                        {% endif %}

                                    </p>

                                </div>
                              </div>

                            


                        
                        
                    </div>

                </div>

                <div class="right grid-minimum grid-card progress" id='progress'>

                    <p id='percent'>
                            
                        NULL

                    </p>

                    <p id='total'>

                        NULL

                    </p>
                    
                </div>
                <iframe src='' id='results-map' class="bottom grid-minimum" style="background-color: greenyellow;">
                    

                </iframe>


              </div>
            
            
            
            
            

        </main>

        <footer class='footer'>

            <div>

                &#0169;2020 <a href="https://tralka.xyz"><strong>Matthew Tralka</strong></a>

            </div>

        </footer>

        <!-- nanobar.js -->
        <script src='https://cdnjs.cloudflare.com/ajax/libs/nanobar/0.4.2/nanobar.min.js'></script>
            
        <!-- Jquery -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script> 
        
        
        
        <!-- Progress Updater -->
        <script type="text/javascript">

            function update_progress(status_url, nanobar) {
                
                $.getJSON(status_url, function(data) {

                    percent = parseInt((data['current'] - 1) * 100 / data['total']);

                    if (percent < 0) {

                        percent = percent * -1;
                    }

                    nanobar.go(percent);

                    $('#percent').text(percent + ' %');

                    $('#status').text(data['status']);
                    $('#code').text(data['state']);

                    $('#total').text( (data['current'] - 1) + ' of ' + data['total'] );

                    if (data['state'] != 'PENDING' && data['state'] != 'IN PROGRESS') {

                        $('#results-map').attr('src', data['result'] );
                        console.log(data['result']);
                        nanobar.go(100);

                        $('#percent').text('100 %');
                        
                        console.log('Complete');
                        $('#status').text('finished');

                    }
                    
                    else {

                        $('#current').text('Current ' + data['current']);
                        setTimeout(function() {
                            update_progress(status_url, nanobar);
                        }, 2000);
                    }
                });
                
            }

        </script>

        <script type="text/javascript">

            $(document).ready( function() {

                var id = '{{ task_id }}';
                var url = '/info/' + String(id);

                var nanobar = new Nanobar({
                        bg: '#44f',
                        target: document.getElementById('progress')
                    });


                update_progress(url, nanobar);

            });

        </script>

    </body>

</html>