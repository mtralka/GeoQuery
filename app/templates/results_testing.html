<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title> SEARCH PAGE </title>

        <meta name="author" content="Matthew Tralka">
        <meta name="description"
            content="">
        <meta name="keywords" content="">
        
        <!-- CSS -->
        <link rel="stylesheet" href="../static/css/normalize.css"/>
        
        <!--
            <link rel="stylesheet" href="{{ url_for ('static', filename= 'css/style.css') }}" />
        -->
        
        <link rel="stylesheet" href="../static/css/home.css"/>

  
        <!-- ADOBE FONTS -->
        <link rel="stylesheet" href="https://use.typekit.net/hwf2qbl.css">

        <!-- typed.js -->
        <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>

        <!--
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        -->

    </head>

    <body>

        <header class='nav'>
        
            <a class='nav-brand' href="/">

                <img src='../static/img/brand.png' alt='GeoQuery' width='70'>

            </a>

            <nav class='nav-sub'>

                <a href="/" class='nav-item'>

                    home

                </a>

                <a href="/search" class='nav-item'>

                    search

                </a>

                <a href="/about" class='nav-item'>

                    about

                </a>

            </nav>

        </header>

        <main>
            
            <div class="grid-container">

                <div class="left grid-minimum grid-card">

                    <h3>

                        Search Criteria

                    </h3>

                    <p>

                        Time: <span id='time'></span>

                    </p>

                    <p>

                        Long: <span id='lon'> </span>

                    </p>

                    <p>

                        Lat: <span id='lat'> </span>

                    </p>
                    
                        
                </div>

                <div class="right grid-minimum grid-card progress" id='progress'>

                    <h3>

                        Search Status

                    </h3>


                    <p id='current'></p>


                    <p id='total'> </p>

                    <p id='code'> </p>

                    <div style="width: 200px;height: 20px;" id='bar'>
                    
                    </div>
                    
                    <button onclick="call('{{task_id}}')">UPDATE</button>


                </div>
                <iframe src='../static/web-map-draft.html'class="bottom grid-minimum" style="background-color: greenyellow;">
                    

                </iframe>


              </div>
            
            
            
            
            

        </main>

        <footer class='footer'>

            <div>

                &#0169;2020 <a href="https://tralka.xyz"><strong>Matthew Tralka</strong></a>

            </div>

        </footer>

        <!-- nanobar.js -->
        <script src='https://cdnjs.cloudflare.com/ajax/libs/nanobar/0.4.2/nanobar.min.js'></script>
            
        <!-- Jquery -->
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script> 
        
        <!-- Progress Updater -->
        
<!-- Progress Updater -->
<script type="text/javascript">

    
    
    


    function call(id) {

        var barred = document.getElementById(bar)
        var nanobar = new Nanobar({
                bg: '#44f',
                target: barred
            });

        var url = '/info/' + String(id);

        update_progress(url, nanobar);

    }

    function update_progress(status_url, nanobar) {
        
        $.getJSON(status_url, function(data) {
            
            percent = parseInt((data['current'] - 1) * 100 / data['total']);
            nanobar.go(percent);
            $('#current').text(percent + '%');
            $('#status').text(data['status']);
            if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
                if ('result' in data) {
                    // show result
                    $('#code').text('Code ' + data['result']);
                    $('#total').text('Total ' + data['total']);
                }
                else {
                    
                    $('#code').text('Result: ' + data['state']);
                }
            }
            else {

                $('#current').text('Current ' + data['current']);
                setTimeout(function() {
                    update_progress(status_url, nanobar);
                }, 2000);
            }
        });
    }


</script>

    </body>

</html>